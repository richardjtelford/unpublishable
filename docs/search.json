[
  {
    "objectID": "about.html",
    "href": "about.html",
    "title": "Richard J. Telford",
    "section": "",
    "text": "I’m an ecologist with interests in quantitative methods and palaeoenvironments. I work at the University of Bergen, Norway, in the Ecological and Environmental Change Research Group, and am affiliated to the Bjerknes Centre for Climate Change.\nMy publication list is available from Google Scholar and ORCID.\n\n\nDisclaimer\nOpinions on this blog are mine, and do not reflect that of the Department of Biological Sciences, University of Bergen or the Bjerknes Centre. Any code presented on this blog is without any guarantee, and analyses may not be appropriate for your data."
  },
  {
    "objectID": "posts/unfortunate-column-name/index.html",
    "href": "posts/unfortunate-column-name/index.html",
    "title": ".data: an unfortunate name for a column",
    "section": "",
    "text": "A colleague came to ask for help today with some code that worked perfectly when run with base R, but failed with an impenetrable error when run through tidyverse.\nHere is a minimal example of the set up, a tibble with a column called .data\n\nlibrary(tidyverse)\n\ndf &lt;- tibble(a = LETTERS[1:5], .data = rnorm(5))\ndf\n\n# A tibble: 5 × 2\n  a      .data\n  &lt;chr&gt;  &lt;dbl&gt;\n1 A     -0.700\n2 B      0.892\n3 C      1.50 \n4 D      0.731\n5 E     -0.440\n\n\n.data is a legal name for a column according to R’s rules for naming objects, and everything appears to be fine.\nWhat could possibly go wrong? Let’s try filtering the column .data to keep just the positive values, first with base R.\n\ndf[df$.data &gt; 0, ]\n\n# A tibble: 3 × 2\n  a     .data\n  &lt;chr&gt; &lt;dbl&gt;\n1 B     0.892\n2 C     1.50 \n3 D     0.731\n\n\nPerfect. And now with dplyr::filter\n\ndf |&gt; filter(.data &gt; 0)\n\nError in `filter()`:\nℹ In argument: `.data &gt; 0`.\nCaused by error:\n! 'list' object cannot be coerced to type 'double'\n\n\nList object cannot be coerced to type double? But the column .data is already a double.\nIt took me a while to workout what was going on, but eventually I remembered that .data is a pronoun in tidyverse (see ?rlang:::.data), used mainly when writing functions using tidyverse. Changing the column name to data fixed the problem.\nSo what does .data do? Consider this code\n\nb &lt;- \"fish\"\ndf &lt;- tibble(a = letters[1:3], b = 1:3)\n\ndf &lt;- df |&gt; mutate(c = b)\n\nWhat will column c contain? The values 1 to 5 from the column b or the word “fish”? Let’s have a peek.\n\ndf\n\n# A tibble: 3 × 3\n  a         b     c\n  &lt;chr&gt; &lt;int&gt; &lt;int&gt;\n1 a         1     1\n2 b         2     2\n3 c         3     3\n\n\nIt took the values from the column. If we wanted to be explicit, we could write\n\n# take b from the column\ndf |&gt; mutate(c = .data$b)\n\n# A tibble: 3 × 3\n  a         b     c\n  &lt;chr&gt; &lt;int&gt; &lt;int&gt;\n1 a         1     1\n2 b         2     2\n3 c         3     3\n\n# take b from the environment with the brace-brace operator\ndf |&gt; mutate(c = {{b}})\n\n# A tibble: 3 × 3\n  a         b c    \n  &lt;chr&gt; &lt;int&gt; &lt;chr&gt;\n1 a         1 fish \n2 b         2 fish \n3 c         3 fish \n\n# take b from the environment with the .env pronoun \ndf |&gt; mutate(c = .env$b)\n\n# A tibble: 3 × 3\n  a         b c    \n  &lt;chr&gt; &lt;int&gt; &lt;chr&gt;\n1 a         1 fish \n2 b         2 fish \n3 c         3 fish \n\n\nIt also useful to use the .data pronoun when writing packages otherwise you get notes from R CMD check.\nIn short, while .data or .env are legal names, they break tidyverse code, so don’t call data.frame columns .data or .env if you ever want to use tidyverse functions."
  },
  {
    "objectID": "posts/formula-R/index.html",
    "href": "posts/formula-R/index.html",
    "title": "Interactions in R formulas",
    "section": "",
    "text": "I happened across a tweet yesterday criticizing a paper\n\n\nNow, while I don’t have a clue what a DiD model is, I do know how to code a interaction in R and that last model most definitely has a interaction.\nFrom the interactions with my response, it seems that many people don’t know all the ways an interaction can be specified in regression models in R.\nThere are three ways include an interaction in a formula.\n\nlibrary(palmerpenguins)\n\n# interaction specified explicitly with :\nlm(body_mass_g ~ sex + year + sex:year, data = penguins)\n\n\nCall:\nlm(formula = body_mass_g ~ sex + year + sex:year, data = penguins)\n\nCoefficients:\n (Intercept)       sexmale          year  sexmale:year  \n  -47659.868     15834.832        25.658        -7.545  \n\n# shortcut with * that expands to give the same model\nlm(body_mass_g ~ sex * year, data = penguins)\n\n\nCall:\nlm(formula = body_mass_g ~ sex * year, data = penguins)\n\nCoefficients:\n (Intercept)       sexmale          year  sexmale:year  \n  -47659.868     15834.832        25.658        -7.545  \n\n# shortcut with ^2 that expands to give the same model\nlm(body_mass_g ~ (sex + year)^2, data = penguins)\n\n\nCall:\nlm(formula = body_mass_g ~ (sex + year)^2, data = penguins)\n\nCoefficients:\n (Intercept)       sexmale          year  sexmale:year  \n  -47659.868     15834.832        25.658        -7.545  \n\n\nIf you compare the coefficients from the three models, you will see that they are identical.\nSince all three ways of coding the interaction give exactly the same result, surely one or two of these forms are redundant.\nWell no. Consider a slightly more complex model where we add an extra prediction and its two - way interactions with the other variables.\n\n# With :\nlm(body_mass_g ~ sex + year + island + sex:year + sex:island + year:island, data = penguins)\n\n\nCall:\nlm(formula = body_mass_g ~ sex + year + island + sex:year + sex:island + \n    year:island, data = penguins)\n\nCoefficients:\n            (Intercept)                  sexmale                     year  \n              -67269.07                 33226.17                    35.65  \n            islandDream          islandTorgersen             sexmale:year  \n               56299.88                378330.62                   -16.16  \n    sexmale:islandDream  sexmale:islandTorgersen         year:islandDream  \n                -245.98                  -140.30                   -28.47  \n   year:islandTorgersen  \n                -188.87  \n\n\nUse the explicit style if you really like typing. With more than a few variables and their interactions this becomes unmanageable.\n\n# With *\nlm(body_mass_g ~ sex * year * island, data = penguins)\n\n\nCall:\nlm(formula = body_mass_g ~ sex * year * island, data = penguins)\n\nCoefficients:\n                 (Intercept)                       sexmale  \n                   -70977.42                      40494.12  \n                        year                   islandDream  \n                       37.50                      73282.82  \n             islandTorgersen                  sexmale:year  \n                   356748.26                        -19.77  \n         sexmale:islandDream       sexmale:islandTorgersen  \n                   -33772.66                      44938.25  \n            year:islandDream          year:islandTorgersen  \n                      -36.93                       -178.12  \n    sexmale:year:islandDream  sexmale:year:islandTorgersen  \n                       16.70                        -22.45  \n\n\nWhoops, that went wrong. It included the three-way interaction as well. We need to remove those by subtracting it in the formula.\n\n# With *, two way only\nlm(body_mass_g ~ sex * year * island - sex:year:island, data = penguins)\n\n\nCall:\nlm(formula = body_mass_g ~ sex * year * island - sex:year:island, \n    data = penguins)\n\nCoefficients:\n            (Intercept)                  sexmale                     year  \n              -67269.07                 33226.17                    35.65  \n            islandDream          islandTorgersen             sexmale:year  \n               56299.88                378330.62                   -16.16  \n    sexmale:islandDream  sexmale:islandTorgersen         year:islandDream  \n                -245.98                  -140.30                   -28.47  \n   year:islandTorgersen  \n                -188.87  \n\n\nThat’s better. If we had many variables with their interactions, subtracting all the four, five or six way interactions would be really tedious.\nFortunately the last style just works.\n\nlm(body_mass_g ~ (sex + year + island)^2, data = penguins)\n\n\nCall:\nlm(formula = body_mass_g ~ (sex + year + island)^2, data = penguins)\n\nCoefficients:\n            (Intercept)                  sexmale                     year  \n              -67269.07                 33226.17                    35.65  \n            islandDream          islandTorgersen             sexmale:year  \n               56299.88                378330.62                   -16.16  \n    sexmale:islandDream  sexmale:islandTorgersen         year:islandDream  \n                -245.98                  -140.30                   -28.47  \n   year:islandTorgersen  \n                -188.87  \n\n\nConcise and it gives us just what we want. If we did want the three way interactions, just replace ^2 with ^3.\n\nlm(body_mass_g ~ (sex + year + island)^3, data = penguins)\n\n\nCall:\nlm(formula = body_mass_g ~ (sex + year + island)^3, data = penguins)\n\nCoefficients:\n                 (Intercept)                       sexmale  \n                   -70977.42                      40494.12  \n                        year                   islandDream  \n                       37.50                      73282.82  \n             islandTorgersen                  sexmale:year  \n                   356748.26                        -19.77  \n         sexmale:islandDream       sexmale:islandTorgersen  \n                   -33772.66                      44938.25  \n            year:islandDream          year:islandTorgersen  \n                      -36.93                       -178.12  \n    sexmale:year:islandDream  sexmale:year:islandTorgersen  \n                       16.70                        -22.45  \n\n\nThis style is particularly useful if we want to include all available variables with the . shortcut. This might be the first step of a backwards selection.\n\nlm(body_mass_g ~ .^2, data = penguins)\n\n\nCall:\nlm(formula = body_mass_g ~ .^2, data = penguins)\n\nCoefficients:\n                       (Intercept)                    speciesChinstrap  \n                        -8.482e+04                           2.520e+04  \n                     speciesGentoo                         islandDream  \n                        -2.695e+05                          -1.123e+04  \n                   islandTorgersen                      bill_length_mm  \n                         4.362e+05                           5.100e+02  \n                     bill_depth_mm                   flipper_length_mm  \n                        -4.756e+04                           4.782e+03  \n                           sexmale                                year  \n                         2.192e+05                           3.374e+01  \n      speciesChinstrap:islandDream           speciesGentoo:islandDream  \n                                NA                                  NA  \n  speciesChinstrap:islandTorgersen       speciesGentoo:islandTorgersen  \n                                NA                                  NA  \n   speciesChinstrap:bill_length_mm        speciesGentoo:bill_length_mm  \n                         1.814e+01                           2.715e+01  \n    speciesChinstrap:bill_depth_mm         speciesGentoo:bill_depth_mm  \n                         5.110e+01                           7.262e+00  \nspeciesChinstrap:flipper_length_mm     speciesGentoo:flipper_length_mm  \n                         3.246e+01                           4.318e+00  \n          speciesChinstrap:sexmale               speciesGentoo:sexmale  \n                        -9.754e+02                          -8.683e+02  \n             speciesChinstrap:year                  speciesGentoo:year  \n                        -1.640e+01                           1.337e+02  \n        islandDream:bill_length_mm      islandTorgersen:bill_length_mm  \n                        -2.722e+01                          -3.077e+01  \n         islandDream:bill_depth_mm       islandTorgersen:bill_depth_mm  \n                        -5.704e+01                          -1.662e+02  \n     islandDream:flipper_length_mm   islandTorgersen:flipper_length_mm  \n                        -1.438e+01                          -8.442e+00  \n               islandDream:sexmale             islandTorgersen:sexmale  \n                         2.136e+02                           2.736e+02  \n                  islandDream:year                islandTorgersen:year  \n                         7.933e+00                          -2.144e+02  \n      bill_length_mm:bill_depth_mm    bill_length_mm:flipper_length_mm  \n                        -2.581e+00                          -1.642e+00  \n            bill_length_mm:sexmale                 bill_length_mm:year  \n                         2.904e+01                          -6.497e-02  \n   bill_depth_mm:flipper_length_mm               bill_depth_mm:sexmale  \n                        -2.579e-02                          -7.168e+01  \n                bill_depth_mm:year           flipper_length_mm:sexmale  \n                         2.381e+01                           1.684e+01  \n            flipper_length_mm:year                        sexmale:year  \n                        -2.341e+00                          -1.105e+02  \n\n\nI think all the styles of specifying interactions are useful. If you don’t, blame Wilkerson and Rogers (1973)."
  },
  {
    "objectID": "posts/welcome/index.html",
    "href": "posts/welcome/index.html",
    "title": "Welcome to my unpublishable thoughts",
    "section": "",
    "text": "For many years, I had a wordpress blog.\nOnce I started using markdown and GitHub, I began to find the Wordpress publication process tedious. Pushing html to GitHub pages is so much easier than copying and pasting, then sorting out the figures in Wordpress. And then there were the eternal battles over how or whether &lt;- would display. Fixing a typo could cause the code to garble itself.\nSome years ago, I looked into using Hugo with markdown, but it just looked like a little too much effort. Now I have coauthored several books using Quarto, a variant of markdown, it seems natural to try a blog using Quarto.\nAt least initially there won’t be a comment section, but I’ll explore options later."
  },
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "Unpublishable thoughts of a palaeoecologist",
    "section": "",
    "text": "Interactions in R formulas\n\n\n\n\n\n\nR\n\n\n\n\n\n\n\n\n\n22 Feb 2024\n\n\nRichard J. Telford\n\n\n\n\n\n\n\n\n\n\n\n\n.data: an unfortunate name for a column\n\n\n\n\n\n\nR\n\n\ntidyverse\n\n\n\n\n\n\n\n\n\n21 Feb 2024\n\n\nRichard J. Telford\n\n\n\n\n\n\n\n\n\n\n\n\nWelcome to my unpublishable thoughts\n\n\n\n\n\n\nnews\n\n\n\n\n\n\n\n\n\n20 Feb 2024\n\n\nRichard J. Telford\n\n\n\n\n\n\nNo matching items"
  }
]